<!DOCTYPE html>
<html lang="en" class="tw-scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOOG Financial Analysis Report</title>

    <meta name="description" content="A comprehensive financial analysis of GOOG as of 251112, covering fundamentals, analyst consensus, and key growth drivers.">
    <meta property="og:title" content="Equity Research: GOOG Analysis">
    <meta property="og:description" content="In-depth financial report on GOOG, detailing its key themes, fundamental health, analyst consensus, and competitor comparison.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://tonynahra.github.io/posts/GOOG_251112.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Equity Research: GOOG Analysis">
    <meta name="twitter:description" content="In-depth financial report on GOOG, detailing its key themes, fundamental health, analyst consensus, and competitor comparison.">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="common/finance-style.css">

    <script>
      tailwind.config = {
        prefix: 'tw-',
      }
    </script>
    
    <style>
        /* Simple spinner styles */
        #loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            flex-direction: column;
            gap: 1rem;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="tw-font-sans tw-bg-gray-50 tw-text-gray-900">

    <div id="loading-spinner">
        <div class="spinner"></div>
        <p class="tw-text-lg tw-font-medium tw-text-gray-700">Loading Financial Report...</p>
    </div>

    <div class="tw-flex">
        <aside id="sidebar-nav" class="tw-w-64 tw-h-screen tw-sticky tw-top-0 tw-overflow-y-auto tw-bg-gray-900 tw-text-white tw-p-4 tw-flex-shrink-0 tw-hidden md:tw-block">
            <h2 class="tw-text-2xl tw-font-bold tw-mb-4 tw-text-blue-400">GOOG Analysis</h2>
            <nav>
                <ul class="tw-space-y-1" id="nav-links">
                    <li><a href="#summary" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Executive Summary</a></li>
                    <li><a href="#overview" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Company Overview</a></li>
                    <li><a href="#consensus" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Analyst Consensus</a></li>
                    <li><a href="#quarterly" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Quarterly Trends</a></li>
                    <li><a href="#fundamental" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Fundamental Analysis</a></li>
                    <li><a href="#interpretation" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Analysis & Interpretation</a></li>
                    <li><a href="#swot" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">SWOT Analysis</a></li>
                    <li><a href="#market" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Market & Competitors</a></li>
                    <li><a href="#benchmark" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Benchmark Comparison</a></li>
                    <li><a href="#technical" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Technical Analysis</a></li>
                    <li><a href="#chart" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-220 tw-ease-in-out hover:tw-bg-gray-700">Price Chart</a></li>
                    <li><a href="#disclaimer" class="tw-block tw-py-1.5 tw-px-3 tw-rounded tw-transition tw-duration-200 tw-ease-in-out hover:tw-bg-gray-700">Disclaimer</a></li>
                </ul>
            </nav>
            <div class="tw-mt-6 tw-pt-4 tw-border-t tw-border-gray-700">
                <a href="https://tonynahra.github.io/" target="_blank" rel="noopener noreferrer" class="tw-text-sm tw-text-gray-400 hover:tw-text-blue-400">About the Author</a>
            </div>
        </aside>

        <main class="tw-flex-1 tw-p-6 md:tw-p-10 tw-max-w-full md:tw-max-w-[calc(100%-16rem)]">
            
            <header class="tw-mb-8 tw-pb-4 tw-border-b tw-border-gray-300">
                <h1 class="tw-text-4xl tw-font-bold tw-text-gray-900">Alphabet Inc. (GOOG)</h1>
                <p class="tw-text-lg tw-text-gray-600">Equity Research Report | <span id="report-date">Loading...</span></p>
            </header>

            <section id="summary" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Executive Summary</h2>
                <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                    <div class="tw-flex tw-items-center tw-mb-4">
                        <h3 class="tw-text-xl tw-font-semibold tw-mr-3">Analyst Rating:</h3>
                        <span id="recommendation-badge" class="tw-px-4 tw-py-1 tw-text-lg tw-font-bold tw-text-white tw-rounded-full tw-bg-gray-400">Loading...</span>
                    </div>
                    <ul id="summary-points" class="tw-list-disc tw-list-inside tw-space-y-2 tw-text-gray-700">
                        <li>Loading summary points...</li>
                    </ul>
                </div>
            </section>

            <section id="overview" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Company Overview</h2>
                <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                    <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 tw-gap-4 tw-mb-6">
                        <div>
                            <strong class="tw-text-gray-600">Company:</strong>
                            <span id="company-name" class="tw-font-medium tw-text-gray-800">Loading...</span>
                        </div>
                        <div>
                            <strong class="tw-text-gray-600">CEO:</strong>
                            <span id="ceo-name" class="tw-font-medium tw-text-gray-800">Loading...</span>
                        </div>
                        <div>
                            <strong class="tw-text-gray-600">Market Cap:</strong>
                            <span id="market-cap" class="tw-font-medium tw-text-gray-800">--</span>
                        </div>
                        <div>
                            <strong class="tw-text-gray-600">Sector:</strong>
                            <span id="sector-name" class="tw-font-medium tw-text-gray-800">Loading...</span>
                        </div>
                        <div>
                            <strong class="tw-text-gray-600">Industry:</strong>
                            <span id="industry-name" class="tw-font-medium tw-text-gray-800">Loading...</span>
                        </div>
                        <div>
                            <strong class="tw-text-gray-600">Website:</strong>
                            <a id="website-link" href="#" class="tw-text-blue-600 hover:tw-underline">Loading...</a>
                        </div>
                    </div>
                    <div id="overview-ai-content" class="tw-space-y-4 tw-text-gray-700">
                        </div>
                </div>
            </section>

            <section id="consensus" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Analyst Consensus</h2>
                <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                    <div class="tw-flex tw-flex-col md:tw-flex-row tw-items-start">
                        <div class="tw-w-full md:tw-w-1/2 tw-pr-4">
                            <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Target Price</h3>
                            <div class="tw-space-y-2 tw-text-lg">
                                <p><strong>Mean:</strong> <span id="target-mean" class="tw-font-bold tw-text-blue-600">--</span></p>
                                <p><strong>High:</strong> <span id="target-high" class="tw-font-bold tw-text-green-600">--</span></p>
                                <p><strong>Low:</strong> <span id="target-low" class="tw-font-bold tw-text-red-600">--</span></p>
                                <p><strong># of Analysts:</strong> <span id="target-analysts">--</span></p>
                            </div>
                        </div>
                        <div class="tw-w-full md:tw-w-1/2 tw-mt-6 md:tw-mt-0">
                            <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Recommendation Trend</h3>
                            <div class="tw-h-64">
                                <canvas id="analystChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="quarterly" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Quarterly Trends (USD)</h2>
                <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                    <div class="tw-h-96">
                        <canvas id="quarterlyChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="fundamental" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Fundamental Analysis (TTM)</h2>
                <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 tw-gap-6">
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-3">TTM Financials (USD)</h3>
                        <table class="tw-w-full tw-text-left">
                            <tbody>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">Total Revenue</td>
                                    <td id="ttm-revenue" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">EBITDA</td>
                                    <td id="ttm-ebitda" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">Net Income</td>
                                    <td id="ttm-netIncome" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">EPS (Diluted)</td>
                                    <td id="ttm-eps" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">Total FCF</td>
                                    <td id="ttm-fcf" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr>
                                    <td class="tw-py-2 tw-text-gray-600">Op. Cash Flow</td>
                                    <td id="ttm-ocf" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-3">Key Ratios (TTM)</h3>
                        <table class="tw-w-full tw-text-left">
                            <tbody>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">P/E Ratio</td>
                                    <td id="ratio-pe" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">Forward P/E</td>
                                    <td id="ratio-forward-pe" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">P/S Ratio</td>
                                    <td id="ratio-ps" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">Profit Margin</td>
                                    <td id="ratio-profit-margin" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr class="tw-border-b tw-border-gray-200">
                                    <td class="tw-py-2 tw-text-gray-600">Return on Equity (ROE)</td>
                                    <td id="ratio-roe" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                                <tr>
                                    <td class="tw-py-2 tw-text-gray-600">Debt/Equity</td>
                                    <td id="ratio-de" class="tw-py-2 tw-font-medium tw-text-right">--</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="interpretation" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Analysis & Interpretation</h2>
                <div class="tw-space-y-6">
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Valuation (P/E Ratio)</h3>
                        <p id="interp-pe" class="tw-text-gray-700">Loading analysis...</p>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Profitability (Profit Margin & ROE)</h3>
                        <p id="interp-profit" class="tw-text-gray-700">Loading analysis...</p>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Financial Health (Debt/Equity)</h3>
                        <p id="interp-health" class="tw-text-gray-700">Loading analysis...</p>
                    </div>
                </div>
            </section>

            <section id="swot" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">SWOT Analysis</h2>
                <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 tw-gap-6">
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-3 tw-text-green-600">Strengths</h3>
                        <ul id="swot-strengths" class="tw-list-disc tw-list-inside tw-space-y-1 tw-text-gray-700">
                            <li>Loading...</li>
                        </ul>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-3 tw-text-red-600">Weaknesses</h3>
                        <ul id="swot-weaknesses" class="tw-list-disc tw-list-inside tw-space-y-1 tw-text-gray-700">
                            <li>Loading...</li>
                        </ul>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-3 tw-text-blue-600">Opportunities</h3>
                        <ul id="swot-opportunities" class="tw-list-disc tw-list-inside tw-space-y-1 tw-text-gray-700">
                            <li>Loading...</li>
                        </ul>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-3 tw-text-yellow-600">Threats</h3>
                        <ul id="swot-threats" class="tw-list-disc tw-list-inside tw-space-y-1 tw-text-gray-700">
                            <li>Loading...</li>
                        </ul>
                    </div>
                </div>
                <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md tw-mt-6">
                    <div id="swot-score" class="tw-text-gray-700">Loading score...</div>
                </div>
            </section>

            <section id="market" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Market & Competitor Analysis</h2>
                <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                    <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Sector Performance</h3>
                    <p id="sector-performance" class="tw-text-gray-700 tw-mb-6">Loading sector analysis...</p>
                    
                    <h3 class="tw-text-xl tw-font-semibold tw-mb-3">Competitor Ratio Comparison</h3>
                    <div class="tw-overflow-x-auto">
                        <table id="competitor-table" class="tw-w-full tw-min-w-max tw-text-left">
                            <thead class="tw-bg-gray-100">
                                <tr>
                                    <th class="tw-p-3 tw-font-semibold tw-text-gray-700">Metric</th>
                                    </tr>
                            </thead>
                            <tbody class="tw-divide-y tw-divide-gray-200">
                                </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="benchmark" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Benchmark Comparison</h2>
                <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                    <h3 class="tw-text-xl tw-font-semibold tw-mb-3">Performance vs. S&P 500 (SPY)</h3>
                    <div class="tw-overflow-x-auto tw-mb-6">
                        <table id="benchmark-table" class="tw-w-full tw-min-w-max tw-text-left">
                            <thead class="tw-bg-gray-100">
                                <tr>
                                    <th class="tw-p-3 tw-font-semibold tw-text-gray-700">Period</th>
                                    </tr>
                            </thead>
                            <tbody class="tw-divide-y tw-divide-gray-200">
                                </tbody>
                        </table>
                    </div>

                    <h3 class="tw-text-xl tw-font-semibold tw-mb-3">1-Year Performance (Visual)</h3>
                    <div id="benchmark-visual-chart" class="tw-space-y-3 tw-p-2">
                        </div>
                </div>
            </section>

            <section id="technical" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Technical Analysis</h2>
                <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 tw-gap-6">
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Trend Analysis</h3>
                        <p class="tw-text-sm tw-text-gray-600">Price: <span id="current-price" class="tw-font-bold">--</span></label>
                        <div class="tw-space-y-1 tw-mt-2">
                            <p>30D SMA: <span id="sma-30" class="tw-font-medium">--</span></p>
                            <p>90D SMA: <span id="sma-90" class="tw-font-medium">--</span></p>
                        </div>
                        <p id="tech-trend-text" class="tw-mt-3 tw-font-semibold tw-text-gray-700">Loading trend...</p>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Momentum (RSI-14)</h3>
                        <p class="tw-text-4xl tw-font-bold tw-text-gray-800 tw-mb-2"><span id="rsi-value">--</span></p>
                        <p id="tech-rsi-text" class="tw-text-lg tw-font-semibold tw-text-gray-700">Loading status...</p>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-2">52-Week Range</h3>
                        <div class="tw-flex tw-justify-between tw-text-sm tw-text-gray-600 tw-mb-1">
                            <span>Low: <span id="low-52w">--</span></span>
                            <span>High: <span id="high-52w">--</span></span>
                        </div>
                        <div class="tw-w-full tw-bg-gray-200 tw-rounded-full tw-h-2.5">
                            <div id="range-bar-inner" class="tw-bg-blue-600 tw-h-2.5 tw-rounded-full" style="width: 0%;"></div>
                        </div>
                        <p class="tw-text-right tw-text-sm tw-mt-1 tw-font-medium">At <span id="range-percent">--</span>% of range</p>
                    </div>
                    <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md">
                        <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Technician's View</h3>
                        <p id="tech-analyst-view" class="tw-text-gray-700">Loading technical summary...</p>
                    </div>
                </div>
            </section>

            <section id="chart" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Interactive Price Chart</h2>
                <div class="tw-bg-white tw-p-2 md:tw-p-4 tw-rounded-lg tw-shadow-md">
                    <div id="priceChartDiv" class="tw-w-full tw-h-[700px]">
                        <div class="tw-flex tw-items-center tw-justify-center tw-h-full tw-text-gray-500">
                            Loading Interactive Chart...
                        </div>
                    </div>
                </div>
            </section>

            <section id="disclaimer" class="tw-mb-12 tw-scroll-mt-20">
                <h2 class="tw-text-3xl tw-font-semibold tw-mb-4">Disclaimer</h2>
                <div class="tw-bg-white tw-p-6 tw-rounded-lg tw-shadow-md tw-text-sm tw-text-gray-600">
                    <p>This report is for informational purposes only and does not constitute investment advice, an offer to sell, or a solicitation of an offer to buy any security. The information contained herein has been compiled from sources believed to be reliable, but its accuracy and completeness are not guaranteed. All opinions and estimates constitute the author's judgment as of the date of this report and are subject to change without notice.</p>
                    <p class="tw-mt-2">The author may hold positions in the securities mentioned. Past performance is not indicative of future results. Investors should conduct their own research and consult with a qualified financial advisor before making any investment decisions.</p>
                </div>
            </section>

        </main>
    </div>

    <script>
        // --- Configuration ---
        const TICKER = "GOOG";
        const FILE_DATE = "251112";
        const RATING = "Buy"; // From prompt

        // --- Helper Functions ---
        const formatLargeNumber = (num) => {
            if (num === null || num === undefined) return '--';
            return Math.abs(Number(num)) >= 1.0e+12
                ? (Math.abs(Number(num)) / 1.0e+12).toFixed(2) + "T"
                : Math.abs(Number(num)) >= 1.0e+9
                ? (Math.abs(Number(num)) / 1.0e+9).toFixed(2) + "B"
                : Math.abs(Number(num)) >= 1.0e+6
                ? (Math.abs(Number(num)) / 1.0e+6).toFixed(2) + "M"
                : Math.abs(Number(num)) >= 1.0e+3
                ? (Math.abs(Number(num)) / 1.0e+3).toFixed(2) + "K"
                : Math.abs(Number(num)).toFixed(2);
        };

        const formatCurrency = (num, fractionDigits = 2) => {
            if (num === null || num === undefined) return '--';
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: fractionDigits,
                maximumFractionDigits: fractionDigits
            }).format(num);
        };

        const formatPercent = (num) => {
            if (num === null || num === undefined) return '--';
            return (num * 100).toFixed(2) + '%';
        };

        const formatDate = (dateString) => {
             // Input format YYMMDD
            const year = "20" + dateString.substring(0, 2);
            const month = dateString.substring(2, 4);
            const day = dateString.substring(4, 6);
            const date = new Date(`${year}-${month}-${day}`);
            return new Intl.DateTimeFormat('en-US', { dateStyle: 'long' }).format(date);
        }

        // --- Main Application Logic ---
        document.addEventListener("DOMContentLoaded", main);

        async function main() {
            const spinner = document.getElementById('loading-spinner');
            try {
                // 1. Fetch Fundamental Data
                const fundamentalsUrl = `fundamentals/${TICKER}_${FILE_DATE}.json`;
                const fundamentalsResponse = await fetch(fundamentalsUrl);
                if (!fundamentalsResponse.ok) throw new Error(`Failed to load fundamentals from ${fundamentalsUrl}`);
                const data = await fundamentalsResponse.json();

                // 2. Populate All Sections
                document.getElementById('report-date').textContent = formatDate(FILE_DATE);
                populateSummary(data);
                populateOverview(data);
                populateAnalystConsensus(data);
                populateQuarterlyTrends(data);
                populateFundamentals(data);
                populateInterpretation(data);
                populateSWOT(data);
                populateMarket(data);
                populateBenchmark(data);
                populateTechnical(data);
                
                // 3. Fetch and Render Chart Data
                // We call this separately as requested
                await createPlotlyChart();

                // 4. Hide Spinner
                spinner.style.display = 'none';

            } catch (error) {
                console.error("Error loading report:", error);
                spinner.innerHTML = `<p class="tw-text-lg tw-font-medium tw-text-red-600">Failed to Load Report Data.<br/>${error.message}</p>`;
            }
        }

        // --- Population Functions ---

        function populateSummary(data) {
            const badge = document.getElementById('recommendation-badge');
            badge.textContent = RATING;
            if (RATING === 'Buy' || RATING === 'Strong Buy') {
                badge.className = 'tw-px-4 tw-py-1 tw-text-lg tw-font-bold tw-text-white tw-rounded-full tw-bg-green-600';
            } else if (RATING === 'Hold') {
                badge.className = 'tw-px-4 tw-py-1 tw-text-lg tw-font-bold tw-text-white tw-rounded-full tw-bg-yellow-500';
            } else {
                badge.className = 'tw-px-4 tw-py-1 tw-text-lg tw-font-bold tw-text-white tw-rounded-full tw-bg-red-600';
            }

            // AI-Generated Summary Points
            const points = [
                `<strong>Strong Buy Rating:</strong> We initiate coverage of Alphabet (GOOG) with a 'Buy' rating, driven by its entrenched "moat" in Search and accelerating growth in the Google Cloud (GCP) and AI segments.`,
                `<strong>Robust Financials:</strong> The company demonstrates exceptional financial health, generating over ${formatLargeNumber(data.fcf.totalFcf_ttm)} in TTM Free Cash Flow, providing ample capital for R&D, strategic acquisitions, and shareholder returns.`,
                `<strong>Attractive Valuation:</strong> Despite its market leadership, GOOG trades at a forward P/E of ${data.mainTicker.forwardPE.toFixed(2)}x, which we view as a reasonable entry point given its growth prospects and dominant market position.`,
                `<strong>Analyst Sentiment:</strong> Wall Street consensus remains bullish, with an average price target of ${formatCurrency(data.consensus.targetMean)}, implying significant upside from the current price.`
            ];
            document.getElementById('summary-points').innerHTML = points.map(p => `<li>${p}</li>`).join('');
        }

        function populateOverview(data) {
            const d = data.mainTicker;
            document.getElementById('company-name').textContent = d.companyName;
            document.getElementById('ceo-name').textContent = d.ceo;
            document.getElementById('market-cap').textContent = formatLargeNumber(d.marketCap);
            document.getElementById('sector-name').textContent = d.sector;
            document.getElementById('industry-name').textContent = d.industry;
            const website = document.getElementById('website-link');
            website.href = d.website;
            website.textContent = d.website;

            // AI-Generated Content
            const aiContent = `
                <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Business Model</h3>
                <p class="tw-mb-4">Alphabet Inc. is a global technology conglomerate built on its core search and advertising business. Its primary revenue stream, Google Services, includes Search, YouTube ads, and Google Network properties. This segment forms a massive, high-margin cash flow engine that funds its other high-growth initiatives: Google Cloud (GCP) and "Other Bets" (e.g., Waymo, Verily). The business model is a flywheel: dominant user-facing products generate data, which refines AI models, improving the products and the ad-targeting, thus attracting more users and advertisers.</p>
                <h3 class="tw-text-xl tw-font-semibold tw-mb-2">Leadership & Strategy</h3>
                <p>Under CEO Sundar Pichai, Alphabet is aggressively pivoting towards an "AI-first" strategy. This involves integrating its advanced Gemini AI models across its entire product suite, from Search (AI Overviews) to Workspace and Cloud. The strategy is twofold: 1) Defend its core Search monopoly from AI-native competitors. 2) Leverage AI to accelerate Google Cloud's market share, positioning it as the premier platform for enterprise AI development. Management's focus on cost discipline ("durable re-engineering") while continuing to invest heavily in AI and Cloud infrastructure is the key strategic balance to watch.</p>
            `;
            document.getElementById('overview-ai-content').innerHTML = aiContent;
        }

        function populateAnalystConsensus(data) {
            const d = data.consensus;
            document.getElementById('target-mean').textContent = formatCurrency(d.targetMean);
            document.getElementById('target-high').textContent = formatCurrency(d.targetHigh);
            document.getElementById('target-low').textContent = formatCurrency(d.targetLow);
            document.getElementById('target-analysts').textContent = d.numberOfAnalysts;

            // Chart.js Doughnut Chart
            const ctx = document.getElementById('analystChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Strong Buy', 'Buy', 'Hold', 'Sell', 'Strong Sell'],
                    datasets: [{
                        label: '# of Analysts',
                        data: [d.strongBuy, d.buy, d.hold, d.sell, d.strongSell],
                        backgroundColor: [
                            'rgba(22, 163, 74, 1)',  // green-600
                            'rgba(5, 150, 105, 1)',   // emerald-600
                            'rgba(245, 158, 11, 1)', // amber-500
                            'rgba(244, 63, 94, 1)',   // rose-500
                            'rgba(220, 38, 38, 1)'  // red-600
                        ],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function populateQuarterlyTrends(data) {
            const quarters = data.quarterly;
            const labels = quarters.map(q => q.period);
            const revenues = quarters.map(q => q.revenue);
            const netIncomes = quarters.map(q => q.netIncome);

            const ctx = document.getElementById('quarterlyChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Revenue',
                            data: revenues,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)', // blue-500
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Net Income',
                            data: netIncomes,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)', // emerald-500
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            type: 'linear',
                            position: 'left',
                            ticks: {
                                callback: function(value) {
                                    return formatLargeNumber(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.raw, 0)}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function populateFundamentals(data) {
            const ttm = data.ttm;
            const ratios = data.ratios;
            // TTM
            document.getElementById('ttm-revenue').textContent = formatLargeNumber(ttm.totalRevenue_ttm);
            document.getElementById('ttm-ebitda').textContent = formatLargeNumber(ttm.ebitda_ttm);
            document.getElementById('ttm-netIncome').textContent = formatLargeNumber(ttm.netIncome_ttm);
            document.getElementById('ttm-eps').textContent = formatCurrency(ttm.eps_ttm);
            document.getElementById('ttm-fcf').textContent = formatLargeNumber(data.fcf.totalFcf_ttm);
            document.getElementById('ttm-ocf').textContent = formatLargeNumber(ttm.operatingCashFlow_ttm);
            // Ratios
            document.getElementById('ratio-pe').textContent = ratios.pe_ttm.toFixed(2);
            document.getElementById('ratio-forward-pe').textContent = data.mainTicker.forwardPE.toFixed(2);
            document.getElementById('ratio-ps').textContent = ratios.ps_ttm.toFixed(2);
            document.getElementById('ratio-profit-margin').textContent = formatPercent(ratios.profitMargin_ttm);
            document.getElementById('ratio-roe').textContent = formatPercent(ratios.roe_ttm);
            document.getElementById('ratio-de').textContent = ratios.debtToEquity_ttm.toFixed(2);
        }

        function populateInterpretation(data) {
            const ratios = data.ratios;
            const mainTicker = data.mainTicker;

            // AI-Generated Interpretations
            document.getElementById('interp-pe').innerHTML = `
                Alphabet's TTM P/E ratio of <strong>${ratios.pe_ttm.toFixed(2)}</strong> and forward P/E of <strong>${mainTicker.forwardPE.toFixed(2)}</strong> suggest a premium valuation, which is justified by its superior growth, market dominance, and high profitability. The forward P/E, being lower than the TTM, indicates analyst expectations of strong earnings growth over the next 12 months, likely driven by Cloud and AI initiatives.
            `;
            document.getElementById('interp-profit').innerHTML = `
                A TTM profit margin of <strong>${formatPercent(ratios.profitMargin_ttm)}</strong> is exceptionally strong for a company of this scale, highlighting its pricing power and operational efficiency. The Return on Equity (ROE) of <strong>${formatPercent(ratios.roe_ttm)}</strong> confirms that management is highly effective at generating profits from shareholder equity. These metrics place GOOG in the top-tier of global enterprises.
            `;
            document.getElementById('interp-health').innerHTML = `
                With a Debt-to-Equity ratio of <strong>${ratios.debtToEquity_ttm.toFixed(2)}</strong>, Alphabet maintains a fortress-like balance sheet. This very low leverage, combined with massive cash flows, gives the company immense financial flexibility to invest in future growth (like AI R&D) and weather any economic downturns without financial distress.
            `;
        }

        function populateSWOT(data) {
            // AI-Generated SWOT Content
            document.getElementById('swot-strengths').innerHTML = [
                `<li><strong>Dominant Market Share:</strong> Unmatched control of global search (~90%+) and digital advertising.</li>`,
                `<li><strong>AI & ML Leadership:</strong> Decades of R&D and ownership of DeepMind/Gemini models provide a significant technological edge.</li>`,
                `<li><strong>Diverse Ecosystem:</strong> Entrenched user base across Search, Android, YouTube, and Workspace creates high switching costs.</li>`,
                `<li><strong>Fortress Balance Sheet:</strong> Massive cash reserves and free cash flow for investment and acquisitions.</li>`
            ].join('');

            document.getElementById('swot-weaknesses').innerHTML = [
                `<li><strong>Ad Revenue Concentration:</strong> Heavy reliance on digital advertising makes it cyclical and vulnerable to market shifts.</li>`,
                `<li><strong>Cloud Market Position:</strong> Remains a distant third in cloud infrastructure behind AWS and Azure.</li>`,
                `<li><strong>Innovation Bureaucracy:</strong> "Other Bets" segment has historically burned significant capital with few commercial successes.</li>`
            ].join('');

            document.getElementById('swot-opportunities').innerHTML = [
                `<li><strong>Google Cloud Growth:</strong> Continued expansion of GCP, particularly by bundling AI services for enterprise clients.</li>`,
                `<li><strong>AI Monetization:</strong> New revenue streams from generative AI in Search, Workspace (Duet AI), and developer APIs.</li>`,
                `<li><strong>YouTube Expansion:</strong> Growth in YouTube Premium, TV, and Shorts monetization.</li>`,
                `<li><strong>Waymo Commercialization:</strong> Long-term potential for autonomous driving technology.</li>`
            ].join('');

            document.getElementById('swot-threats').innerHTML = [
                `<li><strong>Regulatory Scrutiny:</strong> Ongoing and escalating antitrust lawsuits in the US and EU targeting its Search and ad-tech businesses.</li>`,
                `<li><strong>AI-Driven Disruption:</strong> New AI-native search competitors (e.g., Perplexity) or changes in user behavior could challenge Search dominance.</li>`,
                `<li><strong>Macroeconomic Headwinds:</strong> A slowdown in global ad spending could impact the core revenue driver.</li>`
            ].join('');

            document.getElementById('swot-score').innerHTML = `
                <strong class="tw-text-lg">SWOT Score: 82/100</strong>
                <p class="tw-mt-1">Alphabet's score reflects its near-insurmountable strengths in AI and market dominance, which provide a powerful foundation for capturing its vast opportunities in Cloud and AI monetization. The primary risk factor is not competition but regulation, which poses a significant and growing threat to its core business practices.</p>
            `;
        }

        function populateMarket(data) {
            // AI-Generated Sector Performance
            document.getElementById('sector-performance').innerHTML = `
                The Communication Services sector has shown robust performance, driven by the mega-cap tech companies within it. The key theme remains the AI arms race, with investors rewarding firms that demonstrate clear AI monetization strategies. While traditional media and telecom companies have lagged, digital advertising and cloud-adjacent businesses like GOOG and META continue to attract the bulk of capital flows.
            `;

            // Dynamic Competitor Table
            const competitors = [data.mainTicker, ...data.competitors];
            const metrics = [
                { label: 'Market Cap', key: 'marketCap', format: formatLargeNumber },
                { label: 'P/E (TTM)', key: 'pe_ttm', format: (n) => n.toFixed(2) },
                { label: 'P/S (TTM)', key: 'ps_ttm', format: (n) => n.toFixed(2) },
                { label: 'Profit Margin', key: 'profitMargin_ttm', format: formatPercent },
                { label: 'ROE (TTM)', key: 'roe_ttm', format: formatPercent }
            ];
            
            const table = document.getElementById('competitor-table');
            const thead = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = ''; // Clear placeholder

            // Build Header
            competitors.forEach(comp => {
                const th = document.createElement('th');
                th.className = 'tw-p-3 tw-font-semibold tw-text-gray-700 tw-text-right';
                th.textContent = comp.ticker;
                thead.appendChild(th);
            });

            // Build Body Rows
            metrics.forEach(metric => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td class="tw-p-3 tw-text-gray-600">${metric.label}</td>`;
                competitors.forEach(comp => {
                    const td = document.createElement('td');
                    td.className = 'tw-p-3 tw-font-medium tw-text-right';
                    let value = comp[metric.key];
                    // Handle nested ratio keys
                    if (!value && data.ratios && comp.ticker === TICKER) value = data.ratios[metric.key];
                    if (!value && comp.ratios) value = comp.ratios[metric.key];
                    
                    td.textContent = (value !== null && value !== undefined) ? metric.format(value) : '--';
                    if (comp.ticker === TICKER) {
                        td.classList.add('tw-font-bold', 'tw-text-blue-700');
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        function populateBenchmark(data) {
            const main = data.mainTicker;
            const bench = data.benchmark;
            
            const periods = [
                { label: '1-Month', key: 'perf_1m' },
                { label: '3-Month', key: 'perf_3m' },
                { label: '1-Year', key: 'perf_1y' },
                { label: 'YTD', key: 'perf_ytd' }
            ];

            const table = document.getElementById('benchmark-table');
            const thead = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = ''; // Clear

            // Build Header
            thead.innerHTML = '<th class="tw-p-3 tw-font-semibold tw-text-gray-700">Period</th>';
            [main, bench].forEach(item => {
                const th = document.createElement('th');
                th.className = 'tw-p-3 tw-font-semibold tw-text-gray-700 tw-text-right';
                th.textContent = item.ticker;
                thead.appendChild(th);
            });
            
            // Build Body Rows
            periods.forEach(period => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td class="tw-p-3 tw-text-gray-600">${period.label}</td>`;
                [main, bench].forEach(item => {
                    const td = document.createElement('td');
                    td.className = 'tw-p-3 tw-font-medium tw-text-right';
                    const perf = item[period.key];
                    td.textContent = formatPercent(perf);
                    td.classList.add(perf >= 0 ? 'tw-text-green-600' : 'tw-text-red-600');
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            // Build Visual Bar Chart
            const visualChart = document.getElementById('benchmark-visual-chart');
            visualChart.innerHTML = ''; // Clear
            const allStocks = [main, ...data.competitors, bench];
            
            // Find max performance to scale bars
            const maxPerf = Math.max(...allStocks.map(s => s.perf_1y));
            const minPerf = Math.min(0, ...allStocks.map(s => s.perf_1y));
            const hasNegative = minPerf < 0;
            const zeroOffsetPercent = hasNegative ? (Math.abs(minPerf) / (maxPerf - minPerf)) * 100 : 0;


            allStocks.forEach(stock => {
                const perf = stock.perf_1y;
                const isMain = stock.ticker === TICKER;
                const isBench = stock.ticker === bench.ticker;
                
                let widthPercent = 0;
                let leftPercent = zeroOffsetPercent;
                let bgColor = perf >= 0 ? 'tw-bg-green-500' : 'tw-bg-red-500';

                if(isMain) bgColor = perf >= 0 ? 'tw-bg-blue-600' : 'tw-bg-red-700';
                if(isBench) bgColor = 'tw-bg-gray-400';

                const totalRange = maxPerf - minPerf;
                widthPercent = (Math.abs(perf) / totalRange) * 100;

                if (perf < 0) {
                    leftPercent = zeroOffsetPercent - widthPercent;
                }

                const barHtml = `
                    <div class="tw-flex tw-items-center tw-gap-3">
                        <span class="tw-w-16 tw-text-sm tw-font-medium tw-text-gray-700 ${isMain ? 'tw-font-bold' : ''}">${stock.ticker}</span>
                        <div class="tw-flex-1 tw-bg-gray-200 tw-rounded-full tw-h-5 tw-relative">
                            <div class="${bgColor} tw-h-5 tw-rounded-full tw-absolute" style="width: ${widthPercent}%; left: ${leftPercent}%;"></div>
                            ${hasNegative && zeroOffsetPercent > 0 && zeroOffsetPercent < 100 ? `<div class="tw-absolute tw-h-full tw-border-l tw-border-gray-500" style="left: ${zeroOffsetPercent}%;"></div>` : ''}
                        </div>
                        <span class="tw-w-16 tw-text-sm tw-font-medium tw-text-right ${perf >= 0 ? 'tw-text-green-600' : 'tw-text-red-600'}">${formatPercent(perf)}</span>
                    </div>
                `;
                visualChart.innerHTML += barHtml;
            });
        }

        function populateTechnical(data) {
            const d = data.mainTicker;
            const price = d.currentPrice;
            const sma30 = d.sma30;
            const sma90 = d.sma90;
            const rsi = d.rsi;
            
            // Card 1: Trend
            document.getElementById('current-price').textContent = formatCurrency(price);
            document.getElementById('sma-30').textContent = formatCurrency(sma30);
            document.getElementById('sma-90').textContent = formatCurrency(sma90);
            const trendText = document.getElementById('tech-trend-text');
            if (price > sma30 && sma30 > sma90) {
                trendText.textContent = "Strong Uptrend";
                trendText.className = 'tw-mt-3 tw-font-semibold tw-text-green-600';
            } else if (price > sma30 || price > sma90) {
                trendText.textContent = "Mild Uptrend";
                trendText.className = 'tw-mt-3 tw-font-semibold tw-text-green-500';
            } else if (price < sma30 && sma30 < sma90) {
                trendText.textContent = "Strong Downtrend";
                trendText.className = 'tw-mt-3 tw-font-semibold tw-text-red-600';
            } else {
                trendText.textContent = "Consolidating";
                trendText.className = 'tw-mt-3 tw-font-semibold tw-text-gray-600';
            }
            
            // Card 2: RSI
            document.getElementById('rsi-value').textContent = rsi.toFixed(2);
            const rsiText = document.getElementById('tech-rsi-text');
            if (rsi > 70) {
                rsiText.textContent = "Overbought";
                rsiText.className = 'tw-text-lg tw-font-semibold tw-text-red-600';
            } else if (rsi < 30) {
                rsiText.textContent = "Oversold";
                rsiText.className = 'tw-text-lg tw-font-semibold tw-text-green-600';
            } else {
                rsiText.textContent = "Neutral";
                rsiText.className = 'tw-text-lg tw-font-semibold tw-text-gray-600';
            }

            // Card 3: 52-Week Range
            document.getElementById('low-52w').textContent = formatCurrency(d.low52w);
            document.getElementById('high-52w').textContent = formatCurrency(d.high52w);
            const pctRange = d.percentRange52w;
            document.getElementById('range-bar-inner').style.width = `${pctRange * 100}%`;
            document.getElementById('range-percent').textContent = formatPercent(pctRange);

            // Card 4: AI-Generated Analyst View
            document.getElementById('tech-analyst-view').innerHTML = `
                From a technical perspective, GOOG is in a confirmed uptrend, trading comfortably above its key 30-day and 90-day moving averages. The RSI at <strong>${rsi.toFixed(2)}</strong> is in neutral territory, suggesting the stock is not over-extended and has room to run before becoming overbought. The price is currently at <strong>${formatPercent(pctRange)}</strong> of its 52-week range, indicating strong relative strength. The overall technical picture supports the bullish fundamental thesis.
            `;
        }
        
        // --- Plotly Chart Function ---
        async function createPlotlyChart() {
            const chartDiv = document.getElementById('priceChartDiv');
            try {
                // 1. Fetch Chart Data
                const chartUrl = `charts/${TICKER}_${FILE_DATE}.json`;
                const response = await fetch(chartUrl);
                if (!response.ok) throw new Error(`Failed to load chart data from ${chartUrl}`);
                const chartData = await response.json();

                // 2. Define Traces
                const tracePrice = {
                    x: chartData.dates,
                    close: chartData.close,
                    high: chartData.high,
                    low: chartData.low,
                    open: chartData.open,
                    type: 'candlestick',
                    name: 'Price',
                    yaxis: 'y'
                };
                
                const traceVolume = {
                    x: chartData.dates,
                    y: chartData.volume,
                    type: 'bar',
                    name: 'Volume',
                    marker: { color: 'rgba(156, 163, 175, 0.5)' }, // gray-400
                    yaxis: 'y2'
                };

                const traceRSI = {
                    x: chartData.dates,
                    y: chartData.rsi,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'RSI (14)',
                    line: { color: '#6366f1' }, // indigo-500
                    yaxis: 'y3'
                };
                
                const traceBB_upper = {
                    x: chartData.dates,
                    y: chartData.bb_upper,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'BB Upper',
                    line: { color: 'rgba(20, 83, 45, 0.5)', dash: 'dash' } // green-900
                };
                
                const traceBB_middle = {
                    x: chartData.dates,
                    y: chartData.bb_middle,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'BB Middle',
                    line: { color: 'rgba(249, 115, 22, 0.5)' } // orange-500
                };
                
                const traceBB_lower = {
                    x: chartData.dates,
                    y: chartData.bb_lower,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'BB Lower',
                    line: { color: 'rgba(20, 83, 45, 0.5)', dash: 'dash' } // green-900
                };

                const data = [tracePrice, traceVolume, traceRSI, traceBB_upper, traceBB_middle, traceBB_lower];

                // 3. Define Layout
                const layout = {
                    title: `${TICKER} Price, Volume, and Indicators`,
                    grid: {
                        rows: 3,
                        columns: 1,
                        pattern: 'independent',
                        roworder: 'bottom to top'
                    },
                    xaxis: {
                        title: 'Date',
                        type: 'date',
                        rangeslider: { visible: false },
                        showticklabels: false,
                    },
                    yaxis: { // Price
                        title: 'Price (USD)',
                        domain: [0.35, 1.0],
                        autorange: true,
                        type: 'linear'
                    },
                    yaxis2: { // Volume
                        title: 'Volume',
                        domain: [0.2, 0.33],
                        autorange: true,
                        type: 'linear',
                        showticklabels: false,
                    },
                    yaxis3: { // RSI
                        title: 'RSI',
                        domain: [0, 0.18],
                        autorange: true,
                        type: 'linear',
                        range: [0, 100],
                        fixedrange: true,
                        showticklabels: true,
                        tickfont: { size: 10 },
                        // Add threshold lines for RSI
                        shapes: [
                            { type: 'line', xref: 'paper', x0: 0, x1: 1, y0: 70, y1: 70, yref: 'y3', line: { color: 'red', dash: 'dot', width: 1} },
                            { type: 'line', xref: 'paper', x0: 0, x1: 1, y0: 30, y1: 30, yref: 'y3', line: { color: 'green', dash: 'dot', width: 1} }
                        ]
                    },
                    legend: {
                        orientation: 'h',
                        y: -0.1,
                        yanchor: 'top'
                    },
                    margin: { l: 50, r: 50, b: 50, t: 50, pad: 4 },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                };

                // 4. Render Chart
                Plotly.newPlot('priceChartDiv', data, layout, { responsive: true });

            } catch (error) {
                console.error("Error creating Plotly chart:", error);
                chartDiv.innerHTML = `<p class="tw-text-lg tw-font-medium tw-text-red-600">Failed to Load Chart.<br/>${error.message}</p>`;
            }
        }

    </script>
    <script src="common/finance-script.js" defer></script>
</body>
</html>
