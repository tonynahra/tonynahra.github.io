window.lpEndLoaded=!0;let endListLinks=[],endSelectedIndex=-1;async function openEndScreen(){const e=document.getElementById("end-screen-modal"),t=document.getElementById("end-album-list"),n=window.location.search.replace("?","").split("#")[0].replace(".json","");if(!e||!t)return;e.style.display="flex",t.innerHTML='<div class="loading-spinner">Loading other albums...</div>',endListLinks=[],endSelectedIndex=-1;try{const o=await fetch(`list_albums.php?album=${encodeURIComponent(n)}`);if(!o.ok)throw new Error("Network response was not ok");const l=await o.json();let a="User";if(l.dir){const e=l.dir.split("/");e.length>1&&(a=e[1])}const d=e.querySelector("h2");d&&(d.textContent=`Other albums by ${a}`),t.innerHTML="",l.albums&&l.albums.length>0?(ul=document.createElement("ul"),ul.className="end-album-list",l.albums.forEach(e=>{const t=document.createElement("li");if(e.is_current)t.className="current",t.textContent=e.name;else{const n=document.createElement("a");n.href=`?${l.dir}/${e.name}#info`,n.textContent=e.name,t.appendChild(n)}ul.appendChild(t)}),container=document.createElement("div"),container.className="album-list-container",container.appendChild(ul),t.appendChild(container),endListLinks=Array.from(ul.querySelectorAll("a"))):t.innerHTML="<p>No other albums found.</p>"}catch(e){console.error(e),t.innerHTML='<p style="color:red">Error loading list.</p>'}}window.lpEndNav=function(e){if(0===endListLinks.length)return;"ArrowDown"===e?(endSelectedIndex++,endSelectedIndex>=endListLinks.length&&(endSelectedIndex=0)):"ArrowUp"===e?(endSelectedIndex--,endSelectedIndex<0&&(endSelectedIndex=endListLinks.length-1)):"Enter"===e&&(endSelectedIndex>-1&&endListLinks[endSelectedIndex]&&endListLinks[endSelectedIndex].click()),endListLinks.forEach((e,t)=>{t===endSelectedIndex?(e.classList.add("keyboard-selected"),e.scrollIntoView({block:"nearest",behavior:"smooth"})):e.classList.remove("keyboard-selected")})},document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("close-end-btn");e&&e.addEventListener("click",()=>{document.getElementById("end-screen-modal").style.display="none"})});
