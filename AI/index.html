<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pulse | Enterprise Monitor</title>
    <style>
        :root {
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --accent: #2563eb;
            --accent-hover: #1d4ed8;
            --success: #198754;
            --error: #dc3545;
            --warning: #ffc107;
            --border: #dee2e6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
        }

        /* --- Header & Layout --- */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-card);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .brand h1 { margin: 0; font-size: 22px; font-weight: 700; letter-spacing: -0.5px; }
        .brand span { font-size: 13px; color: var(--text-secondary); background: #e9ecef; padding: 4px 8px; border-radius: 6px; }

        .actions {
            display: flex;
            gap: 12px;
        }

        /* --- Buttons --- */
        .btn {
            border: 1px solid var(--border);
            background: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover { background: #f8f9fa; border-color: #adb5bd; }
        .btn-primary { background: var(--accent); color: white; border-color: var(--accent); }
        .btn-primary:hover { background: var(--accent-hover); }
        .btn-test-all { background: var(--text-primary); color: white; border-color: var(--text-primary); }
        .btn-test-all:hover { background: black; }

        /* --- Main Table --- */
        .dashboard {
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            overflow: hidden;
        }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 18px 25px; background: #f8f9fa; color: var(--text-secondary); font-size: 13px; text-transform: uppercase; font-weight: 600; }
        td { padding: 16px 25px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #fcfcfc; }

        /* --- Table Components --- */
        .provider-name { font-weight: 600; font-size: 15px; display: block; }
        .provider-meta { font-size: 12px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; margin-top: 4px; }
        .badge-free { color: var(--success); background: #d1e7dd; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 700; }
        .badge-paid { color: #856404; background: #fff3cd; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 700; }

        .model-selector {
            width: 100%;
            max-width: 250px;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            width: 90px;
            justify-content: center;
        }
        .status-idle { background: #e9ecef; color: var(--text-secondary); }
        .status-success { background: #d1e7dd; color: var(--success); }
        .status-error { background: #f8d7da; color: var(--error); }
        .status-loading { background: #e2e3e5; color: var(--text-primary); animation: pulse 1.5s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* --- Modal for Keys --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }
        .modal {
            background: white;
            width: 500px;
            max-width: 90%;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
        .key-row { margin-bottom: 15px; }
        .key-row label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 5px; }
        .key-input { width: 95%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-family: monospace; }
        
        .code-snippet { font-family: monospace; font-size: 12px; color: #666; background: #f1f1f1; padding: 2px 5px; border-radius: 4px; }
    </style>
</head>
<body>

<div id="keyModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h2 style="margin:0">üîê Secure Vault</h2>
            <button class="btn" onclick="toggleModal(false)">Close</button>
        </div>
        <p style="font-size: 13px; color: #666; margin-bottom: 20px;">
            API keys are stored securely in your browser's Local Storage. They are never sent to our servers.
        </p>
        <div id="keyInputsContainer">
            </div>
        <div style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
            <button class="btn" onclick="exportKeys()">üíæ Backup to JSON</button>
            <button class="btn btn-primary" onclick="saveKeysAndClose()">Save & Close</button>
        </div>
    </div>
</div>

<div class="header-bar">
    <div class="brand">
        <h1>AI Pulse</h1>
        <span>v2.0</span>
    </div>
    <div class="actions">
        <input type="file" id="fileInput" accept=".json" style="display:none" onchange="importKeys(this)">
        <button class="btn" onclick="document.getElementById('fileInput').click()">üìÇ Import Config</button>
        <button class="btn" onclick="toggleModal(true)">üîë Manage API Keys</button>
        <button class="btn btn-test-all" onclick="runGlobalTest()">‚ö° Run System Check</button>
    </div>
</div>

<div class="dashboard">
    <table id="mainTable">
        <thead>
            <tr>
                <th width="25%">Provider Details</th>
                <th width="25%">Model Pointer (Alias)</th>
                <th width="30%">Service Limits</th>
                <th width="10%">Status</th>
                <th width="10%">Latency</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>
</div>

<div style="margin-top: 20px; color: #999; font-size: 12px; text-align: center;">
    AI Pulse runs 100% client-side. No data is collected.
</div>

<script>
    // --- 1. CONFIGURATION: Providers & Smart Pointers ---
    const providers = [
        {
            id: "gemini",
            name: "Google Gemini",
            freeTier: true,
            limits: "15 RPM (Free), 2M tokens context",
            // Smart Pointers: These automatically point to latest stable versions
            pointers: ["gemini-1.5-flash", "gemini-1.5-pro", "gemini-2.0-flash-exp"], 
            endpoint: "https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent?key={key}",
            method: "POST",
            testBody: (model) => JSON.stringify({ contents: [{ parts: [{ text: "Hello" }] }] })
        },
        {
            id: "groq",
            name: "Groq",
            freeTier: true,
            limits: "30 RPM, 14.4k req/day (Free)",
            pointers: ["llama-3.3-70b-versatile", "mixtral-8x7b-32768"],
            endpoint: "https://api.groq.com/openai/v1/chat/completions",
            method: "POST",
            testBody: (model) => JSON.stringify({ model: model, messages: [{ role: "user", content: "Hi" }] })
        },
        {
            id: "openai",
            name: "OpenAI",
            freeTier: false,
            limits: "Paid/Pre-paid Only",
            pointers: ["gpt-4o", "gpt-4o-mini", "gpt-3.5-turbo"], // Aliases
            endpoint: "https://api.openai.com/v1/chat/completions",
            method: "POST",
            testBody: (model) => JSON.stringify({ model: model, messages: [{ role: "user", content: "Hi" }] })
        },
        {
            id: "deepseek",
            name: "DeepSeek",
            freeTier: true,
            limits: "Very low cost, Compatible API",
            pointers: ["deepseek-chat", "deepseek-coder"], // Points to V3
            endpoint: "https://api.deepseek.com/chat/completions",
            method: "POST",
            testBody: (model) => JSON.stringify({ model: model, messages: [{ role: "user", content: "Hi" }] })
        },
        {
            id: "anthropic",
            name: "Anthropic",
            freeTier: false,
            limits: "Pre-paid credits ($5 min)",
            pointers: ["claude-3-5-sonnet-latest", "claude-3-5-haiku-latest"], // Use 'latest' pointers
            endpoint: "https://api.anthropic.com/v1/messages",
            method: "POST",
            headers: { "x-api-version": "2023-06-01", "anthropic-dangerously-allow-browser": "true" },
            testBody: (model) => JSON.stringify({ model: model, max_tokens: 50, messages: [{ role: "user", content: "Hi" }] })
        },
        {
            id: "openrouter",
            name: "OpenRouter",
            freeTier: true,
            limits: "Aggregator (Access to 100+ models)",
            pointers: ["google/gemini-2.0-flash-exp:free", "meta-llama/llama-3.2-11b-vision-instruct:free"],
            endpoint: "https://openrouter.ai/api/v1/chat/completions",
            method: "POST",
            testBody: (model) => JSON.stringify({ model: model, messages: [{ role: "user", content: "Hi" }] })
        },
        {
            id: "sambanova",
            name: "SambaNova",
            freeTier: true,
            limits: "High Speed Inference (Free Tier Avail)",
            pointers: ["Meta-Llama-3.1-70B-Instruct", "Meta-Llama-3.1-8B-Instruct"],
            endpoint: "https://api.sambanova.ai/v1/chat/completions",
            method: "POST",
            testBody: (model) => JSON.stringify({ model: model, messages: [{ role: "user", content: "Hi" }] })
        },
        {
            id: "together",
            name: "Together AI",
            freeTier: true,
            limits: "Trial credits ($5)",
            pointers: ["meta-llama/Llama-3.3-70B-Instruct-Turbo", "mistralai/Mixtral-8x7B-Instruct-v0.1"],
            endpoint: "https://api.together.xyz/v1/chat/completions",
            method: "POST",
            testBody: (model) => JSON.stringify({ model: model, messages: [{ role: "user", content: "Hi" }] })
        },
        {
            id: "cohere",
            name: "Cohere",
            freeTier: true,
            limits: "Trial keys: 5 calls/min",
            pointers: ["command-r-plus", "command-r"],
            endpoint: "https://api.cohere.com/v1/chat",
            method: "POST",
            testBody: (model) => JSON.stringify({ model: model, message: "Hi" })
        },
        {
            id: "mistral",
            name: "Mistral",
            freeTier: true,
            limits: "Rate limited on free tier",
            pointers: ["mistral-large-latest", "mistral-small-latest"],
            endpoint: "https://api.mistral.ai/v1/chat/completions",
            method: "POST",
            testBody: (model) => JSON.stringify({ model: model, messages: [{ role: "user", content: "Hi" }] })
        }
    ];

    // Global Key Storage
    let apiKeys = {};

    // --- 2. INITIALIZATION ---
    document.addEventListener("DOMContentLoaded", () => {
        loadKeys();
        renderTable();
        renderKeyInputs();
    });

    // --- 3. RENDERING ---
    function renderTable() {
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

        providers.forEach((p, index) => {
            const tr = document.createElement("tr");
            
            // Badge Logic
            const tierBadge = p.freeTier 
                ? `<span class="badge-free">FREE TIER</span>` 
                : `<span class="badge-paid">PAID/TRIAL</span>`;

            // Pointer Selector
            const options = p.pointers.map(ptr => `<option value="${ptr}">${ptr}</option>`).join("");
            
            tr.innerHTML = `
                <td>
                    <span class="provider-name">${p.name}</span>
                    <div class="provider-meta">${tierBadge}</div>
                </td>
                <td>
                    <select id="model-${index}" class="model-selector" onchange="saveConfig()">${options}</select>
                </td>
                <td style="font-size: 13px; color: #555;">
                    ${p.limits}
                </td>
                <td>
                    <div id="status-${index}" class="status-pill status-idle">Idle</div>
                </td>
                <td id="latency-${index}" style="font-family:monospace; font-weight:bold;">
                    --
                </td>
            `;
            tbody.appendChild(tr);
        });
        
        // Restore previous model selections if they exist
        const savedConfig = localStorage.getItem("ai_pulse_model_selections");
        if(savedConfig) {
            const selections = JSON.parse(savedConfig);
            providers.forEach((p, idx) => {
                if(selections[p.id]) {
                    const select = document.getElementById(`model-${idx}`);
                    if(select) select.value = selections[p.id];
                }
            });
        }
    }

    function renderKeyInputs() {
        const container = document.getElementById("keyInputsContainer");
        container.innerHTML = "";
        providers.forEach(p => {
            const div = document.createElement("div");
            div.className = "key-row";
            div.innerHTML = `
                <label>${p.name} API Key</label>
                <input type="password" id="key-input-${p.id}" class="key-input" placeholder="sk-..." value="${apiKeys[p.id] || ''}">
            `;
            container.appendChild(div);
        });
    }

    // --- 4. LOGIC & TESTING ---
    async function runGlobalTest() {
        // Disable button during test
        const btn = document.querySelector('.btn-test-all');
        const originalText = btn.innerHTML;
        btn.innerHTML = "‚è≥ Testing...";
        btn.disabled = true;

        const promises = providers.map((p, index) => testProvider(index));
        await Promise.all(promises);

        btn.innerHTML = originalText;
        btn.disabled = false;
    }

    async function testProvider(index) {
        const p = providers[index];
        const key = apiKeys[p.id];
        const model = document.getElementById(`model-${index}`).value;
        const statusEl = document.getElementById(`status-${index}`);
        const latencyEl = document.getElementById(`latency-${index}`);

        if (!key) {
            statusEl.className = "status-pill status-idle";
            statusEl.innerText = "No Key";
            statusEl.style.background = "#e9ecef";
            statusEl.style.color = "#999";
            return;
        }

        statusEl.className = "status-pill status-loading";
        statusEl.innerText = "Testing";
        
        const start = performance.now();

        try {
            let url = p.endpoint.replace("{model}", model).replace("{key}", key);
            
            const headers = { "Content-Type": "application/json" };
            
            // Authorization Logic
            if (p.id !== 'gemini') headers["Authorization"] = `Bearer ${key}`;
            if (p.id === 'anthropic') {
                headers["x-api-key"] = key;
                delete headers["Authorization"];
                Object.assign(headers, p.headers);
            }

            const response = await fetch(url, {
                method: p.method,
                headers: headers,
                body: p.testBody(model)
            });

            const duration = ((performance.now() - start) / 1000).toFixed(2);

            if (response.ok) {
                statusEl.className = "status-pill status-success";
                statusEl.innerText = "ONLINE";
                latencyEl.innerText = duration + "s";
                latencyEl.style.color = "#198754";
            } else {
                throw new Error(response.status);
            }
        } catch (e) {
            statusEl.className = "status-pill status-error";
            statusEl.innerText = "ERROR";
            latencyEl.innerText = "Fail";
            latencyEl.style.color = "#dc3545";
            console.error(`${p.name} failed:`, e);
        }
    }

    // --- 5. KEY & CONFIG MANAGEMENT ---
    function toggleModal(show) {
        document.getElementById("keyModal").style.display = show ? "flex" : "none";
        if (show) renderKeyInputs(); // Refresh inputs when opening
    }

    function saveKeysAndClose() {
        providers.forEach(p => {
            const val = document.getElementById(`key-input-${p.id}`).value.trim();
            if (val) apiKeys[p.id] = val;
            else delete apiKeys[p.id];
        });
        localStorage.setItem("ai_pulse_keys", JSON.stringify(apiKeys));
        toggleModal(false);
        // Also save model selections
        saveConfig();
        alert("Keys saved to browser storage.");
    }

    function saveConfig() {
        // Save currently selected models
        const selections = {};
        providers.forEach((p, idx) => {
            selections[p.id] = document.getElementById(`model-${idx}`).value;
        });
        localStorage.setItem("ai_pulse_model_selections", JSON.stringify(selections));
    }

    function loadKeys() {
        const stored = localStorage.getItem("ai_pulse_keys");
        if (stored) apiKeys = JSON.parse(stored);
    }

    function exportKeys() {
        const data = {
            keys: apiKeys,
            config: JSON.parse(localStorage.getItem("ai_pulse_model_selections") || "{}")
        };
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
        const dl = document.createElement('a');
        dl.setAttribute("href", dataStr);
        dl.setAttribute("download", "ai_pulse_config.json");
        document.body.appendChild(dl);
        dl.click();
        dl.remove();
    }

    function importKeys(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.keys) {
                    apiKeys = data.keys;
                    localStorage.setItem("ai_pulse_keys", JSON.stringify(apiKeys));
                }
                if (data.config) {
                    localStorage.setItem("ai_pulse_model_selections", JSON.stringify(data.config));
                }
                location.reload(); // Reload to apply
            } catch (err) {
                alert("Error reading JSON file");
            }
        };
        reader.readAsText(file);
    }
</script>

</body>
</html>
